CODEX FIX REQUEST: TypeScript Compilation Errors in Cached Database Architecture

## PROBLEM SUMMARY
The cached database architecture implementation has TypeScript compilation errors that prevent the backend from starting. The implementation is 99% complete but has several critical bugs that need to be fixed.

## CURRENT ERRORS (7 Total)

### Error 1: deals.service.ts (line 315-321)
```
error TS2345: Argument of type '{ by: "program"[]; _count: { id: true; }; where: { OR: ({ expiresAt: null; } | { expiresAt: { gt: Date; }; })[]; }; }' is not assignable to parameter of type '{ by: "program"[]; _count: { id: true; }; where: { OR: ({ expiresAt: null; } | { expiresAt: { gt: Date; }; })[]; }; } & { orderBy?: SeatsAeroDealOrderByWithAggregationInput | SeatsAeroDealOrderByWithAggregationInput[] | undefined; } & SeatsAeroProgramStat[]'.
```

**Location**: `apps/api/src/deals/deals.service.ts:315`
**Issue**: Incorrect type assertion for Prisma groupBy result
**Fix**: Remove the type assertion `as SeatsAeroProgramStat[]` from line 321

### Error 2: seats-aero-partner.service.ts (line 223)
```
error TS2304: Cannot find name 'normalizedPrograms'.
```

**Location**: `User/ehfuzzz/Desktop/Mile Buy Club/apps/api/src/deals/seats-aero-partner.service.ts:223`
**Issue**: Variable `normalizedPrograms` is not defined in scope
**Fix**: The variable should be defined earlier in the function or use the correct variable name

### Error 3-7: seats-aero-partner.service.ts (lines 224-225)
```
error TS7006: Parameter 'program' implicitly has an 'any' type.
error TS2304: Cannot find name 'failures'.
error TS7006: Parameter 'failure' implicitly has an 'any' type.
```

**Location**: `apps/api/src/deals/seats-aero-partner.service.ts:224-225`
**Issue**: Undefined variables `failures` and implicit `any` types
**Fix**: Define the `failures` array and add proper type annotations

## SPECIFIC FIXES REQUIRED

### Fix 1: deals.service.ts (line 321)
**Current code:**
```typescript
const stats = (await this.prisma.seatsAeroDeal.groupBy({
  by: ['program'],
  _count: { id: true },
  where: {
    OR: [{ expiresAt: null }, { expiresAt: { gt: now } }],
  },
})) as SeatsAeroProgramStat[];
```

**Fixed code:**
```typescript
const stats = await this.prisma.seatsAeroDeal.groupBy({
  by: ['program'],
  _count: { id: true },
  where: {
    OR: [{ expiresAt: null }, { expiresAt: { gt: now } }],
  },
});
```

### Fix 2: seats-aero-partner.service.ts (lines 223-225)
**Current code:**
```typescript
}). Deduped total: ${dedupedDeals.length}. Successful programs: ${normalizedPrograms
  .filter((program) => !failures.find((failure) => failure.program === program))
  .join(', ') || 'none'}. Failed programs: ${failures.map((failure) => failure.program).join(', ') || 'none'}.`,
```

**Fixed code:**
```typescript
}). Deduped total: ${dedupedDeals.length}. Successful programs: ${programs
  .filter((program: string) => !failures.find((failure: { program: string; error: unknown }) => failure.program === program))
  .join(', ') || 'none'}. Failed programs: ${failures.map((failure: { program: string; error: unknown }) => failure.program).join(', ') || 'none'}.`,
```

**Note**: You need to ensure that:
1. `programs` variable is defined in scope (replace `normalizedPrograms` with the correct variable name)
2. `failures` array is defined earlier in the function
3. Add proper type annotations for the callback parameters

## REQUIREMENTS

### 1. Fix All TypeScript Compilation Errors
- Fix the type assertion error in `deals.service.ts:321`
- Fix the undefined variable errors in `seats-aero-partner.service.ts:223-225`
- Ensure the backend compiles without errors
- Ensure the backend starts successfully

### 2. Verify Cached Architecture Works
- Ensure the `listDeals()` method in DealsService uses cached data from the `seatsAeroDeal` table
- Ensure the admin endpoints (`/deals/admin/refresh-seats-aero` and `/deals/admin/seats-aero-stats`) are accessible
- Ensure the circular dependency between DealsModule and DataCollectionModule is properly resolved

### 3. Test the Implementation
After fixing the errors, the following should work:
- `GET /deals?programs=united&limit=1` should return deals from the cached `seatsAeroDeal` table
- The response should show `userId: 'seats-aero-cached'` and `dataSource: 'cached'` in the meta object
- `POST /deals/admin/refresh-seats-aero` should trigger the SeatsAeroCollectorService to collect data
- `GET /deals/admin/seats-aero-stats` should return statistics about cached deals by program

## EXPECTED BEHAVIOR

### Cached Data Flow
1. **Background Collection**: SeatsAeroCollectorService runs every 30 minutes via cron job
2. **Data Storage**: Collected deals are stored in the `seatsAeroDeal` table
3. **Data Serving**: DealsService.listDeals() queries the `seatsAeroDeal` table and serves cached data
4. **Admin Control**: Admin endpoints allow manual refresh and statistics viewing

### Response Format
When querying `/deals?programs=united&limit=1`, the response should:
- Include deals from the cached database (not real-time API calls)
- Show `provider: "Seats.aero Â· united"` (not just `"SEATS_AERO"`)
- Show `userId: "seats-aero-cached"` in meta (not `"seats-aero"`)
- Show `dataSource: "cached"` in meta
- Include the correct `program` field in each deal

## TESTING VERIFICATION

After the fix, verify:
1. Backend starts without TypeScript errors
2. Cached data is served from the database (not real-time API calls)
3. Admin endpoints are accessible
4. Multiple airlines can be queried (united, american, delta, etc.)
5. The SeatsAeroCollectorService can be manually triggered via `/deals/admin/refresh-seats-aero`

## IMPORTANT NOTES
- Do NOT remove the cached database architecture
- Do NOT revert to the old real-time API approach
- Do NOT create mock or placeholder data
- Fix ONLY the TypeScript compilation errors and ensure the cached architecture works as designed
- Ensure the circular dependency is properly resolved using `forwardRef()`
- Ensure admin endpoints are properly registered in the DealsController

## FILES TO FIX
- `apps/api/src/deals/deals.service.ts` (line 321 - remove type assertion)
- `apps/api/src/deals/seats-aero-partner.service.ts` (lines 223-225 - fix undefined variables and add type annotations)

Please fix these errors and ensure the cached database architecture works correctly.
